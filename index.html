<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>911 Dispatch Simulation</title>
<style>
/* Reset */
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#1c92d2,#f2fcfe);color:#fff;display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:20px;}
img{max-width:180px;margin:20px auto;border-radius:12px;display:block;}
.card{background:rgba(0,0,0,0.2);padding:20px;margin:15px auto;border-radius:12px;max-width:900px;width:100%;box-shadow:0 8px 20px rgba(0,0,0,0.3);}
h2,h3{text-align:center;margin-bottom:10px;}
input,select,textarea,button{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:none;font-size:1em;}
button{background:linear-gradient(to right,#2575fc,#6a11cb);color:#fff;font-weight:bold;cursor:pointer;transition:0.3s;}
button:hover{opacity:0.9;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{padding:10px;border:1px solid #fff;text-align:center;}
th{background:rgba(255,255,255,0.2);}
ul{list-style:none;padding-left:0;}
li button{margin-left:10px;}
#liveCallList li{margin-bottom:6px;}
footer{text-align:center;padding:15px;font-size:0.9em;opacity:0.8;margin-top:20px;}
@media(max-width:768px){.card{padding:15px;}}
</style>
</head>
<body>

<img src="https://sdmntprnorthcentralus.oaiusercontent.com/files/00000000-7c9c-622f-ae4e-fd7da774c7d3/raw?se=2025-08-30T05%3A14%3A55Z&sp=r&sv=2024-08-04&sr=b&scid=55e111af-e330-5bff-b3f6-22bb066912e1&skoid=add8ee7d-5fc7-451e-b06e-a82b2276cf62&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2025-08-29T19%3A52%3A52Z&ske=2025-08-30T19%3A52%3A52Z&sks=b&skv=2024-08-04&sig=x9S9pY9JHsODKlcYnlkjmfJnSgDpBqWTd7z6JTQQBu4%3D" alt="911 Dispatch Logo">

<!-- Login -->
<div id="loginDiv" class="card">
<h2>Login</h2>
<form id="loginForm">
<input type="text" id="username" placeholder="Username" required>
<input type="password" id="password" placeholder="Password" required>
<button type="submit">Login</button>
</form>
</div>

<!-- Admin Panel -->
<div id="adminPanel" class="card" style="display:none;">
<h2>Admin Panel</h2>

<h3>User Management</h3>
<input type="text" id="newUser" placeholder="New Username">
<input type="password" id="newPass" placeholder="Password">
<select id="newRole">
<option value="Admin">Admin</option>
<option value="Dispatcher High Command">Dispatcher High Command</option>
<option value="Dispatcher Trainee">Dispatcher Trainee</option>
</select>
<button onclick="createUser()">Create User</button>
<h4>Existing Users</h4>
<ul id="userList"></ul>

<h3>Scenario Management</h3>
<input type="text" id="scenarioText" placeholder="Scenario Description">
<button onclick="addScenario()">Add Scenario</button>
<button onclick="deleteScenario()">Delete Last Scenario</button>

<h3>Live Calls</h3>
<input type="text" id="callDesc" placeholder="Call Description">
<input type="text" id="callLoc" placeholder="Call Location">
<button onclick="createLiveCall()">Create Live Call</button>

<h3>Results</h3>
<button onclick="showResults()">View All Results</button>
<button onclick="exportResults()">Export CSV</button>
</div>

<!-- Dispatcher Panel -->
<div id="dispatcherPanel" class="card" style="display:none;">
<h2>Dispatcher Panel</h2>
<h3 id="currentScenario">No scenario loaded</h3>
<textarea id="callNotes" placeholder="Enter call notes here..."></textarea>
<select id="serviceSelect">
<option value="Fire">Fire</option>
<option value="EMS">EMS</option>
<option value="Police">Police</option>
</select>
<button onclick="submitDispatch()">Submit</button>

<h3>Feedback & Review</h3>
<textarea id="feedback" placeholder="Enter feedback"></textarea>
<textarea id="review" placeholder="Enter review"></textarea>
<button onclick="submitFeedback()">Submit Feedback</button>

<h3>Live Calls Queue</h3>
<ul id="liveCallList"></ul>
</div>

<!-- Results Panel -->
<div id="resultsDiv" class="card" style="display:none;">
<h2>All Submissions</h2>
<table id="resultsTable">
<thead>
<tr>
<th>User</th><th>Scenario</th><th>Score</th><th>Eligible</th><th>Service</th><th>Pass/Fail</th><th>Feedback</th><th>Review</th>
</tr>
</thead>
<tbody></tbody>
</table>
<button onclick="closeResults()">Close</button>
</div>

<footer>
Powered by Nextwave Roleplay Development Team | Powered by Shadowisfun
</footer>

<script>
// ---------- Data ----------
let users=JSON.parse(localStorage.getItem('users'))||[];
let scenarios=JSON.parse(localStorage.getItem('scenarios'))||[];
let results=JSON.parse(localStorage.getItem('results'))||[];
let liveCalls=JSON.parse(localStorage.getItem('liveCalls'))||[];
let currentUser=null;
let currentScenarioIndex=0;

// Owner login setup
if(!users.find(u=>u.username==='shadowisfun')){
    users.push({username:'shadowisfun', password:'aidenfav88!', rank:'Admin'});
} else {
    users = users.map(u=>{ if(u.username==='shadowisfun'){ u.password='aidenfav88!'; } return u; });
}
localStorage.setItem('users', JSON.stringify(users));

// ---------- Login ----------
document.getElementById('loginForm').addEventListener('submit', function(e){
    e.preventDefault();
    const username=document.getElementById('username').value;
    const password=document.getElementById('password').value;
    const user=users.find(u=>u.username===username&&u.password===password);
    if(user){
        currentUser=user;
        alert('Login successful! Role: '+user.rank);
        document.getElementById('loginDiv').style.display='none';
        if(user.rank.includes('Dispatcher')){
            document.getElementById('dispatcherPanel').style.display='block';
            loadScenario();
            updateLiveCalls();
        } else if(user.rank==='Admin'){
            document.getElementById('adminPanel').style.display='block';
            updateUserList();
        }
    } else alert('Incorrect credentials.');
});

// ---------- Admin Functions ----------
function createUser(){
    const username=document.getElementById('newUser').value.trim();
    const password=document.getElementById('newPass').value.trim();
    const role=document.getElementById('newRole').value;
    if(!username||!password){ alert('Fill all fields'); return; }
    if(users.find(u=>u.username===username)){ alert('Username exists'); return; }
    users.push({username,password,rank:role});
    localStorage.setItem('users',JSON.stringify(users));
    alert('User created!');
    updateUserList();
}
function updateUserList(){
    const ul=document.getElementById('userList');
    ul.innerHTML='';
    users.forEach((u,i)=>{
        const li=document.createElement('li');
        li.textContent=`${u.username} (${u.rank}) `;
        const delBtn=document.createElement('button');
        delBtn.textContent='Remove';
        delBtn.onclick=()=>{ users.splice(i,1); localStorage.setItem('users',JSON.stringify(users)); updateUserList(); };
        li.appendChild(delBtn);
        ul.appendChild(li);
    });
}

// ---------- Scenario ----------
function addScenario(){
    const text=document.getElementById('scenarioText').value.trim();
    if(!text){ alert('Enter scenario'); return; }
    scenarios.push(text);
    localStorage.setItem('scenarios',JSON.stringify(scenarios));
    alert('Scenario added!');
}
function deleteScenario(){
    if(scenarios.length>0){ scenarios.pop(); localStorage.setItem('scenarios',JSON.stringify(scenarios)); alert('Last scenario deleted!'); }
    else alert('No scenarios!');
}

// ---------- Live Calls ----------
function createLiveCall(){
    const desc=document.getElementById('callDesc').value.trim();
    const loc=document.getElementById('callLoc').value.trim();
    if(!desc||!loc){ alert('Fill all fields'); return; }
    liveCalls.push({desc,loc,assigned:false,user:'',notes:'',service:'',score:0,eligible:false,feedback:'',review:''});
    localStorage.setItem('liveCalls',JSON.stringify(liveCalls));
    alert('Live call created!');
    updateLiveCalls();
}
function updateLiveCalls(){
    const ul=document.getElementById('liveCallList');
    ul.innerHTML='';
    liveCalls.forEach(c=>{
        const li=document.createElement('li');
        li.textContent=`${c.desc} (${c.loc}) - Assigned: ${c.assigned ? c.user : 'No'}`;
        ul.appendChild(li);
    });
}

// ---------- Dispatcher ----------
function loadScenario(){
    if(scenarios.length===0){ document.getElementById('currentScenario').innerText='No scenarios available'; return; }
    currentScenarioIndex = currentScenarioIndex % scenarios.length;
    document.getElementById('currentScenario').innerText = scenarios[currentScenarioIndex];
}
function submitDispatch(){
    const notes=document.getElementById('callNotes').value.trim();
    const service=document.getElementById('serviceSelect').value;
    if(!notes){ alert('Enter notes'); return; }
    const score=notes.length;
    const eligible = score>=50;
    results.push({user:currentUser.username, scenario:scenarios[currentScenarioIndex], score, eligible, service, passfail:'Pending', feedback:'', review:''});
    localStorage.setItem('results',JSON.stringify(results));
    alert(`Submitted! Score: ${score}, Eligible: ${eligible ? 'Yes':'No'}`);
    currentScenarioIndex++;
    loadScenario();
    document.getElementById('callNotes').value='';
}
function submitFeedback(){
    const fb=document.getElementById('feedback').value.trim();
    const rev=document.getElementById('review').value.trim();
    if(results.length===0){ alert('No submissions yet'); return; }
    results[results.length-1].feedback=fb;
    results[results.length-1].review=rev;
    localStorage.setItem('results',JSON.stringify(results));
    alert('Feedback submitted!');
    document.getElementById('feedback').value='';
    document.getElementById('review').value='';
}

// ---------- Admin Results ----------
function showResults(){
    document.getElementById('resultsDiv').style.display='block';
    const tbody=document.getElementById('resultsTable').querySelector('tbody');
    tbody.innerHTML='';
    results.forEach(r=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${r.user}</td><td>${r.scenario}</td><td>${r.score}</td><td>${r.eligible?'Yes':'No'}</td><td>${r.service}</td>
        <td contenteditable="true">${r.passfail}</td><td contenteditable="true">${r.feedback}</td><td contenteditable="true">${r.review}</td>`;
        tbody.appendChild(tr);
    });
}
function closeResults(){ document.getElementById('resultsDiv').style.display='none'; }
function exportResults(){
    let csv='User,Scenario,Score,Eligible,Service,Pass/Fail,Feedback,Review\n';
    results.forEach(r=>{ csv+=`${r.user},${r.scenario},${r.score},${r.eligible?'Yes':'No'},${r.service},${r.passfail},${r.feedback},${r.review}\n`; });
    const a=document.createElement('a');
    a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);
    a.download='results.csv';
    a.click();
}
</script>
</body>
</html>

