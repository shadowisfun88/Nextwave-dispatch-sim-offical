<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>911 Dispatch Simulator</title>
<style>
body{margin:0;font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#1c92d2,#6dd5ed);color:#fff;display:flex;flex-direction:column;min-height:100vh;}
img.logo{max-width:150px;margin-bottom:20px;}
.container{width:100%;display:flex;justify-content:center;align-items:center;flex:1;}
.card{background:rgba(0,0,0,0.25);padding:30px;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,0.4);width:350px;text-align:center;}
input,button{width:100%;padding:12px;margin:10px 0;border-radius:8px;border:none;font-size:1em;}
input{background:rgba(255,255,255,0.2);color:#fff;}
input::placeholder{color:rgba(255,255,255,0.7);}
button{background:linear-gradient(90deg,#2575fc,#6a11cb);color:#fff;font-weight:bold;cursor:pointer;transition:0.3s;}
button:hover{opacity:0.9;}
p.link{cursor:pointer;text-decoration:underline;margin-top:10px;color:#fff;}
h2{margin-bottom:20px;}
.sidebar{background:rgba(0,0,0,0.3);width:220px;min-height:100vh;padding:20px;position:fixed;display:none;}
.sidebar h3{margin-bottom:15px;}
.sidebar button{width:100%;margin:5px 0;background:linear-gradient(to right,#2575fc,#6a11cb);padding:10px;border:none;border-radius:6px;cursor:pointer;transition:0.3s;}
.sidebar button:hover{opacity:0.9;}
.main{margin-left:240px;padding:20px;flex:1;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{padding:10px;border:1px solid #fff;text-align:center;}
th{background:rgba(255,255,255,0.2);}
ul{list-style:none;padding-left:0;}
#liveCallList li{margin-bottom:6px;}
.status-pending{color:yellow;font-weight:bold;}
.status-waiting{color:deepskyblue;font-weight:bold;}
.status-passed{color:limegreen;font-weight:bold;}
.status-failed{color:red;font-weight:bold;}
footer{text-align:center;padding:15px;font-size:0.9em;opacity:0.8;margin-top:20px;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);justify-content:center;align-items:center;}
.modal .card{width:400px;position:relative;}
.modal .close{position:absolute;top:10px;right:15px;cursor:pointer;font-size:20px;}
#liveAdminControls{margin-bottom:15px;display:none;}
@media(max-width:768px){.sidebar{position:relative;width:100%;}.main{margin-left:0;}}
</style>
</head>
<body>

<div class="container">
<!-- LOGIN -->
<div id="loginDiv" class="card">
<img class="logo" src="https://i.imgur.com/NxV5G4V.png" alt="911 Dispatch Logo">
<h2>Login</h2>
<input type="text" id="loginUser" placeholder="Username">
<input type="password" id="loginPass" placeholder="Password">
<button onclick="login(document.getElementById('loginUser').value, document.getElementById('loginPass').value)">Login</button>
<button onclick="openRequestModal()">Request Account</button>
</div>
</div>

<!-- REQUEST ACCOUNT MODAL -->
<div id="requestModal" class="modal">
  <div class="card">
    <span class="close" onclick="closeRequestModal()">Ã—</span>
    <img class="logo" src="https://i.imgur.com/NxV5G4V.png" alt="911 Dispatch Logo">
    <h2>Request Account</h2>
    <input type="text" id="reqUser" placeholder="Preferred Username">
    <input type="password" id="reqPass" placeholder="Password">
    <input type="text" id="reqDiscord" placeholder="Your Discord Name">
    <button onclick="requestAccount()">Submit Request</button>
    <p class="link" onclick="closeRequestModal()">Back to Login</p>
    <div id="reqStatus"></div>
  </div>
</div>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
<h3 id="userRole"></h3>
<button onclick="showPanel('dashboard')">Dashboard</button>
<button onclick="showPanel('live')">Live Calls</button>
<button onclick="showPanel('scenarios')">Scenarios</button>
<button onclick="showPanel('results')">Results</button>
<button onclick="showPanel('pending')" id="pendingBtn">Pending Accounts</button>
<button onclick="logout()">Logout</button>
</div>

<!-- MAIN CONTENT -->
<div class="main">
<div id="dashboard" class="card" style="display:none;">
<h2>Welcome, <span id="dashUser"></span></h2>
<p>Status: <span id="userStatus" class="status-pending">Pending Approval</span></p>
</div>

<div id="live" class="card" style="display:none;">
<h2>Live Calls</h2>
<div id="liveAdminControls">
  <input type="text" id="liveDesc" placeholder="Call Description">
  <input type="text" id="liveLoc" placeholder="Location">
  <button onclick="addLiveCall()">Add Live Call</button>
</div>
<ul id="liveCallList"></ul>
</div>

<div id="scenarios" class="card" style="display:none;">
<h2>Scenario Management</h2>
<input type="text" id="scenarioText" placeholder="Scenario Description">
<button onclick="addScenario()">Add Scenario</button>
<button onclick="deleteScenario()">Delete Last Scenario</button>
<ul id="scenarioList"></ul>
</div>

<div id="results" class="card" style="display:none;">
<h2>All Submissions</h2>
<table id="resultsTable">
<thead>
<tr>
<th>User</th><th>Scenario</th><th>Score</th><th>Eligible</th><th>Service</th><th>Pass/Fail</th><th>Feedback</th><th>Review</th>
</tr>
</thead>
<tbody></tbody>
</table>
<button onclick="exportResults()">Export CSV</button>
</div>

<div id="pending" class="card" style="display:none;">
<h2>Pending Accounts</h2>
<ul id="pendingList"></ul>
</div>
</div>

<footer>
Powered by Nextwave Roleplay Development Team | Powered by Shadowisfun
</footer>

<script>
// DATA
let users=JSON.parse(localStorage.getItem('users'))||[];
let pendingAccounts=JSON.parse(localStorage.getItem('pendingAccounts'))||[];
let scenarios=JSON.parse(localStorage.getItem('scenarios'))||[];
let liveCalls=JSON.parse(localStorage.getItem('liveCalls'))||[];
let results=JSON.parse(localStorage.getItem('results'))||[];
let currentUser=null;

// OWNER ADMIN SETUP
if(!users.find(u=>u.username==='shadowisfun')){
  users.push({username:'shadowisfun', password:'aidenfav88!', rank:'Admin'});
  localStorage.setItem('users',JSON.stringify(users));
}

// MODAL FUNCTIONS
function openRequestModal(){document.getElementById('requestModal').style.display='flex';}
function closeRequestModal(){document.getElementById('requestModal').style.display='none';}

// SHOW PANELS
function showPanel(id){
  ['dashboard','live','scenarios','results','pending'].forEach(p=>document.getElementById(p).style.display='none');
  document.getElementById(id).style.display='block';
}

// LOGIN
function login(username,password){
  const user=users.find(u=>u.username===username && u.password===password);
  if(!user){ alert('Incorrect credentials or account not approved yet.'); return; }
  currentUser=user;
  document.getElementById('loginDiv').style.display='none';
  document.getElementById('requestModal').style.display='none';
  document.getElementById('sidebar').style.display='block';
  document.getElementById('dashUser').innerText=currentUser.username;
  document.getElementById('userRole').innerText=currentUser.rank;
  document.getElementById('userStatus').innerText = (currentUser.rank==='Admin'||currentUser.rank==='Dispatcher High Command')?'Approved':'Pending Approval';

  // Sidebar buttons
  document.getElementById('pendingBtn').style.display = (currentUser.rank==='Admin')?'block':'none';
  document.querySelector('.sidebar button[onclick*="results"]').style.display='block';

  // Update panels
  showPanel('dashboard');
  updateScenarioUI();
  updateLiveUI();
  updateScenarioList();
  updateLiveCalls();
  updateResults();
  updatePending();
}

// LOGOUT
function logout(){
  currentUser=null;
  document.getElementById('sidebar').style.display='none';
  document.getElementById('loginDiv').style.display='block';
  ['dashboard','live','scenarios','results','pending'].forEach(p=>document.getElementById(p).style.display='none');
  document.getElementById('requestModal').style.display='none';
}

// REQUEST ACCOUNT
function requestAccount(){
  const username=document.getElementById('reqUser').value.trim();
  const password=document.getElementById('reqPass').value.trim();
  const discord=document.getElementById('reqDiscord').value.trim();
  if(!username||!password||!discord){alert('Fill all fields'); return;}
  pendingAccounts.push({username,password,discord,status:'Pending'});
  localStorage.setItem('pendingAccounts',JSON.stringify(pendingAccounts));
  alert('Request submitted. Waiting for Admin approval.');
  closeRequestModal();
}

// SCENARIO MANAGEMENT
function addScenario(){
  if(currentUser.rank!=='Admin'){alert('Only Admin can add scenarios'); return;}
  const desc=document.getElementById('scenarioText').value.trim();
  if(!desc){alert('Enter scenario'); return;}
  scenarios.push(desc);
  localStorage.setItem('scenarios',JSON.stringify(scenarios));
  document.getElementById('scenarioText').value='';
  updateScenarioList();
}

function deleteScenario(){
  if(currentUser.rank!=='Admin'){alert('Only Admin can delete scenarios'); return;}
  scenarios.pop();
  localStorage.setItem('scenarios',JSON.stringify(scenarios));
  updateScenarioList();
}

function updateScenarioList(){
  const ul=document.getElementById('scenarioList'); ul.innerHTML='';
  scenarios.forEach((s,i)=>{const li=document.createElement('li'); li.textContent=s; ul.appendChild(li);});
}

function updateScenarioUI(){
  if(currentUser.rank!=='Admin'){
    document.getElementById('scenarioText').style.display='none';
    document.querySelectorAll('#scenarios button').forEach(b=>b.style.display='none');
  } else {
    document.getElementById('scenarioText').style.display='block';
    document.querySelectorAll('#scenarios button').forEach(b=>b.style.display='block');
  }
}

// LIVE CALLS
function addLiveCall(){
  if(!(currentUser.rank==='Admin'||currentUser.rank==='Dispatcher High Command')){alert('Not authorized'); return;}
  const desc=document.getElementById('liveDesc').value.trim();
  const loc=document.getElementById('liveLoc').value.trim();
  if(!desc||!loc){alert('Fill all fields'); return;}
  liveCalls.push({desc,loc,assigned:false});
  localStorage.setItem('liveCalls',JSON.stringify(liveCalls));
  document.getElementById('liveDesc').value=''; document.getElementById('liveLoc').value='';
  updateLiveCalls();
}

function updateLiveCalls(){
  const ul=document.getElementById('liveCallList'); ul.innerHTML='';
  liveCalls.forEach((c,i)=>{
    const li=document.createElement('li'); 
    li.textContent=`${c.desc} (${c.loc}) `;
    if(!c.assigned && (currentUser.rank==='Admin'||currentUser.rank==='Dispatcher High Command'||currentUser.rank==='Dispatcher Trainee')){
      const fire=document.createElement('button'); fire.textContent='Fire'; fire.onclick=()=>dispatchCall(i,'Fire');
      const ems=document.createElement('button'); ems.textContent='EMS'; ems.onclick=()=>dispatchCall(i,'EMS');
      const police=document.createElement('button'); police.textContent='Police'; police.onclick=()=>dispatchCall(i,'Police');
      li.appendChild(fire); li.appendChild(ems); li.appendChild(police);
    } else if(c.assigned){
      li.textContent+=`[Dispatched: ${c.service}]`;
    }
    ul.appendChild(li);
  });
}

function dispatchCall(index,service){
  const call=liveCalls[index]; if(!call||call.assigned) return;
  call.assigned=true; call.service=service;
  results.push({user:currentUser.username,desc:call.desc,score:Math.floor(Math.random()*100)+1,eligible:true,service:service,passfail:'Waiting',feedback:'',review:''});
  localStorage.setItem('liveCalls',JSON.stringify(liveCalls));
  localStorage.setItem('results',JSON.stringify(results));
  updateLiveCalls(); updateResults();
}

function updateLiveUI(){
  document.getElementById('liveAdminControls').style.display = (currentUser.rank==='Admin'||currentUser.rank==='Dispatcher High Command')?'block':'none';
}

// RESULTS
function updateResults(){
  const tbody=document.getElementById('resultsTable').querySelector('tbody'); tbody.innerHTML='';
  results.forEach(r=>{
    if(currentUser.rank!=='Admin' && r.user!==currentUser.username) return;
    const tr=document.createElement('tr');
    let statusClass='status-waiting';
    if(r.passfail==='Passed') statusClass='status-passed';
    else if(r.passfail==='Failed') statusClass='status-failed';
    tr.innerHTML=`<td>${r.user}</td><td>${r.desc||''}</td><td>${r.score}</td><td>${r.eligible?'Yes':'No'}</td><td>${r.service}</td><td class="${statusClass}">${r.passfail}</td><td>${r.feedback}</td><td>${r.review}</td>`;
    tbody.appendChild(tr);
  });
}

function exportResults(){
  let csv='User,Scenario,Score,Eligible,Service,Pass/Fail,Feedback,Review\n';
  results.forEach(r=>{csv+=`${r.user},${r.desc||''},${r.score},${r.eligible?'Yes':'No'},${r.service},${r.passfail},${r.feedback},${r.review}\n`;});
  const a=document.createElement('a'); a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv); a.download='results.csv'; a.click();
}

// PENDING ACCOUNTS
function updatePending(){
  const ul=document.getElementById('pendingList'); ul.innerHTML='';
  if(currentUser.rank!=='Admin') return;
  pendingAccounts.forEach((p,i)=>{
    const li=document.createElement('li'); li.textContent=`${p.username} (${p.discord}) - ${p.status} `;
    const approve=document.createElement('button'); approve.textContent='Approve';
    approve.onclick=()=>{users.push({username:p.username,password:p.password,rank:'Dispatcher Trainee'}); localStorage.setItem('users',JSON.stringify(users)); pendingAccounts.splice(i,1); localStorage.setItem('pendingAccounts',JSON.stringify(pendingAccounts)); updatePending(); alert(`Approved ${p.username}`);};
    const deny=document.createElement('button'); deny.textContent='Deny';
    deny.onclick=()=>{pendingAccounts.splice(i,1); localStorage.setItem('pendingAccounts',JSON.stringify(pendingAccounts)); updatePending(); alert(`Denied ${p.username}`);};
    li.appendChild(approve); li.appendChild(deny); ul.appendChild(li);
  });
}
</script>

</body>
</html>


